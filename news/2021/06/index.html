<!DOCTYPE html>
<html lang="zh-cn">
<head prefix="og: http://ogp.me/ns#">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <title>News | YXZ's Blog</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Canonical links -->
  <link rel="canonical" href="https://yaoxuanzhi.github.io/news/2021/06/index.html">
  <!-- Alternative links -->
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/icon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/icon/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">
  <meta name="generator" content="Hexo 3.8.0">
  <!-- CSS -->
  <!-- build:css build/css/navy.css -->
  <link rel="stylesheet" href="/css/navy.css">
  <!-- endbuild -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css">
  <!-- RSS -->
  <link rel="alternate" href="/atom.xml" title="YXZ's Blog">
  <!-- Open Graph -->
  <meta property="og:type" content="website">
<meta property="og:title" content="News">
<meta property="og:url" content="https://yaoxuanzhi.github.io/news/2021/06/index.html">
<meta property="og:site_name" content="YXZ&#39;s Blog">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="News">
  <!-- Google Analytics --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  
</head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <header id="header" class="wrapper">
  <div id="header-inner" class="inner">
    <h1 id="logo-wrap">
      <a href="/" id="logo">YXZ's Blog</a>
    </h1>
    <nav id="main-nav">
      <a href="/news/" class="main-nav-link">随笔</a><a href="/dev/" class="main-nav-link">开发</a><a href="/open_source/" class="main-nav-link">开源</a><a href="/tool/" class="main-nav-link">工具</a><a href="/about/" class="main-nav-link">关于我</a>
    </nav>
    <div id="lang-select-wrap">
      <label id="lang-select-label"><i class="fa fa-globe"></i><span>简体中文</span></label>
      <select id="lang-select" data-canonical="">
        
          <option value="zh-cn" selected>简体中文</option>
        
      </select>
    </div>
    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

    
<div id="content-wrap">
  <div class="wrapper">
    <div class="inner">
      
        
          <article class="article post" itemscope itemtype="http://schema.org/Article">
  <header class="article-header">
    
      <h1>
        <a href="/news/2021/06/12/improve-msys2/" class="article-title" itemprop="name">拓展msys2</a>
      </h1>
    
    <a href="/news/2021/06/12/improve-msys2/" class="article-date"><time datetime="2021-06-12T00:00:00.000Z">2021-06-12</time></a>
  </header>
  <div class="article-content" itemprop="articleBody">
    <h2 id="前言" class="article-heading"><a href="#前言" class="headerlink" title="前言"></a>前言<a class="article-anchor" href="#前言" aria-hidden="true"></a></h2><p>由于新工作的开发需要，其服务器工程在windows下需要借助msys2上的gcc环境来进行编译并运行，因此，日常开发工作中，需要经常打开msys2终端来输入各种shell指令</p>
<p>但本人更加偏好有个集成的dos脚本，在上面输入【1】【2】【3】等数字之后，就能执行相应的【构建】【启动】【测试】等命令，并且直接调用msys2上的类linux环境来执行这些命令</p>
<p>本着 <strong>自己动手 丰衣足食</strong> 的打算，已经将这个集成脚本完成了，本篇文章是其副产物</p>
<h2 id="为msys2的追加镜像源" class="article-heading"><a href="#为msys2的追加镜像源" class="headerlink" title="为msys2的追加镜像源"></a>为msys2的追加镜像源<a class="article-anchor" href="#为msys2的追加镜像源" aria-hidden="true"></a></h2><p>基于 <a href="https://mirrors.tuna.tsinghua.edu.cn/help/msys2/" target="_blank" rel="noopener">《MSYS2 镜像使用帮助》</a>提供的实现思路，最初使用Python来快速实现了一个脚本</p>
<details><br>  <summary>append_extra_mirror_source.py</summary><br><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># !/user/bin/env python</span><br><span class="hljs-comment"># -*- coding:utf-8 -*- </span><br><span class="hljs-keyword">import</span> os, glob, codecs, re, argparse<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add_mirror_url</span><span class="hljs-params">(mirror_url)</span>:</span><br>    mirror_paths = glob.glob(<span class="hljs-string">"mirrorlist*"</span>)<br><br>    re_pattern = <span class="hljs-string">r'(Server = )(https.*.org)(.*)'</span><br><br>    <span class="hljs-keyword">for</span> path <span class="hljs-keyword">in</span> mirror_paths:<br>        <span class="hljs-keyword">with</span> codecs.open(path, mode=<span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>, errors=<span class="hljs-string">'ignore'</span>) <span class="hljs-keyword">as</span> f:<br>            config = f.read()<br>            f.close()<br>            search_re = re.search(re_pattern, config, re.M|re.I)<br>            exist_same_re = re.search(mirror_url, config, re.M|re.I)<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> exist_same_re <span class="hljs-keyword">and</span> search_re:<br>                mirror_url_item = search_re.group()<br>                temp = re.compile(re_pattern)<br>                mirror_url_item = temp.sub(<span class="hljs-string">r'\1%(mirror_url)s\3'</span> % &#123;<span class="hljs-string">'mirror_url'</span>: mirror_url&#125;, mirror_url_item)<br>                new_config = <span class="hljs-string">'%(mirror_url)s\n%(source)s'</span> % &#123;<span class="hljs-string">'mirror_url'</span>: mirror_url_item, <span class="hljs-string">'source'</span>: config&#125;<br>                outfile = codecs.open(path, <span class="hljs-string">'w'</span>, <span class="hljs-string">'utf-8'</span>)<br>                outfile.write(new_config)<br>                outfile.close()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    parser = argparse.ArgumentParser()<br>    parser.add_argument(<span class="hljs-string">"-url"</span>, <span class="hljs-string">"--mirror_url"</span>, help=<span class="hljs-string">"输入其他镜像源"</span>, default=<span class="hljs-string">"https://mirrors.cloud.tencent.com/msys2"</span>)<br>    parser.add_argument(<span class="hljs-string">"-msys2"</span>, <span class="hljs-string">"--msys2_dir"</span>, help=<span class="hljs-string">"msys2安装目录"</span>, default=<span class="hljs-string">"C:/msys64"</span>)<br><br>    args = parser.parse_args()<br><br>    pacman_mirror_dir = <span class="hljs-string">"%s/etc/pacman.d"</span> % (args.msys2_dir)<br>    os.chdir(pacman_mirror_dir)<br>    add_mirror_url(args.mirror_url)<br></code></pre></td></tr></table></figure><br><br></details>

<p>但考虑到后续会推广给不会撸码的童鞋使用这个集成脚本，而这些童鞋大部分都是首次安装msys2的，因此，基于Python实现的脚本显然是不行的，又重新实现了一个bash脚本</p>
<p>由于bash脚本本身对文件、字符串等操作的支持极其有限，在此使用了msys2内置的sed、cp、cat、grep等工具来实现</p>
<p>在编写这个bash脚本的时候，遇到了一些知识盲区，特意记录下来：</p>
<ul>
<li>✔ grep正则查找</li>
<li>✔ sed正则替换需要对双引号、小括号等特殊字符进行前置转义</li>
<li>✔ 在shell函数内修改传参变量的内容</li>
<li>✔ 在文件首行插入新内容</li>
</ul>
<details><br>  <summary>append_extra_mirror_source.sh</summary><br><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash<br></span><br><span class="hljs-comment"># sed 需要对斜杆和括号等字符进行转义后才能正常正则替换</span><br><span class="hljs-function"><span class="hljs-title">replace_escape_string</span></span>()&#123;<br>    <span class="hljs-built_in">eval</span> <span class="hljs-variable">$2</span>=\<span class="hljs-string">"<span class="hljs-variable">$(eval echo "\$&#123;$1&#125;" | sed "s/\//\\\\\//g; s/(/\\\\(/g; s/)</span>/\\\\)/g"</span>)\<span class="hljs-string">"<br>&#125;<br><br># 在文件头上加入其它镜像源<br>push_front_mirror_url()&#123;<br>    _source_config_file=<span class="hljs-variable">$1</span><br>    _backup_config_file=<span class="hljs-variable">$(dirname $1)</span>/bak_<span class="hljs-variable">$(basename $1)</span><br>    _old_mirror_pattern=<span class="hljs-variable">$2</span><br>    _new_mirror_host=<span class="hljs-variable">$3</span><br><br>    # 备份原本的镜像源配置<br>    if [ ! -f <span class="hljs-variable">$&#123;_backup_config_file&#125;</span> ]; then<br>        cp <span class="hljs-variable">$_source_config_file</span> <span class="hljs-variable">$&#123;_backup_config_file&#125;</span><br>    fi<br><br>    # 找到镜像源配置模板<br>    mirror_temp_url=<span class="hljs-variable">$(grep -r -P "$_old_mirror_pattern" $&#123;_backup_config_file&#125;)</span><br><br>    replace_escape_string _old_mirror_pattern _old_mirror_pattern<br>    replace_escape_string _new_mirror_host _new_mirror_host<br><br>    # 根据模板镜像源修改成新的镜像源<br>    new_mirror_url=<span class="hljs-variable">$(echo $mirror_temp_url | sed "s/$_old_mirror_pattern/\\1$_new_mirror_host\\3/g")</span><br><br>    # 在文件头上插入新的镜像源链接<br>    (echo <span class="hljs-variable">$new_mirror_url</span> &amp;&amp; cat <span class="hljs-variable">$&#123;_backup_config_file&#125;</span>) &gt; <span class="hljs-variable">$_source_config_file</span><br>&#125;<br><br>main()&#123;<br>    # 腾讯云镜像源<br>    # new_mirror_host="</span>https://mirrors.cloud.tencent.com/msys2<span class="hljs-string">"<br><br>    # 清华镜像源<br>    new_mirror_host="</span>https://mirrors.tuna.tsinghua.edu.cn/msys2<span class="hljs-string">"<br><br>    old_mirror_pattern="</span>(Server.*)(http.*repo.msys2.org)(.*)<span class="hljs-string">"<br><br>    if [ <span class="hljs-variable">$&#123;#&#125;</span> == 1 ]; then<br>        new_mirror_host=<span class="hljs-variable">$1</span><br>    fi<br><br>    # 遍历pacman的镜像源配置<br>    for file in /etc/pacman.d/mirror*; do<br>        push_front_mirror_url <span class="hljs-variable">$file</span> <span class="hljs-variable">$old_mirror_pattern</span> <span class="hljs-variable">$new_mirror_host</span><br>    done<br>&#125;<br><br>main <span class="hljs-variable">$1</span></span><br></code></pre></td></tr></table></figure><br><br></details>

<h2 id="拓展msys2" class="article-heading"><a href="#拓展msys2" class="headerlink" title="拓展msys2"></a>拓展msys2<a class="article-anchor" href="#拓展msys2" aria-hidden="true"></a></h2><h3 id="让msys2支持在dos上直接执行shell指令" class="article-heading"><a href="#让msys2支持在dos上直接执行shell指令" class="headerlink" title="让msys2支持在dos上直接执行shell指令"></a>让msys2支持在dos上直接执行shell指令<a class="article-anchor" href="#让msys2支持在dos上直接执行shell指令" aria-hidden="true"></a></h3><p>在着手实现过程中，以下这些点是挺有意思的：</p>
<ul>
<li>✔ 在dos中调用msys2来直接执行shell指令<blockquote>
<p>详情看msys2_shell.cmd里面的<code>!SHELL_ARGS!</code>参数，其实它实现了一个外部参数并不是msys2_shell.cmd的内置参数数，则会原样传递到终端上，结合<code>bash -c cmd</code>即可实现外部调用</p>
</blockquote>
</li>
<li>✔ 如何指定msys2的启动目录<blockquote>
<p>详情看msys2_shell.cmd的参数列表：<code>-where dir</code></p>
</blockquote>
</li>
<li>✔ 在msys2里，将父bash的alias传递给子bash，并且执行其它指令<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">bash --noprofile --rcfile &lt;(<span class="hljs-built_in">alias</span>)<br></code></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="将msys2添加到右键菜单上" class="article-heading"><a href="#将msys2添加到右键菜单上" class="headerlink" title="将msys2添加到右键菜单上"></a>将msys2添加到右键菜单上<a class="article-anchor" href="#将msys2添加到右键菜单上" aria-hidden="true"></a></h3><ul>
<li>✔ 在目录下或者文件夹上执行该菜单命令时，启动msys2并定位到该目录下</li>
<li>✔ 在某个文件上执行该菜单命令时，启动msys2，定位到该文件所在目录，并用Vim打开该文件</li>
</ul>
<details><br>  <summary>msys2_vim_installer.bat</summary><br><br><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br>::判断是否已经获取了管理员身份<br><span class="hljs-built_in">Md</span> "<span class="hljs-variable">%WinDir%</span>\System32\test_permissions" <span class="hljs-number">2</span>&gt;<span class="hljs-built_in">NUL</span>||(<span class="hljs-built_in">Echo</span> 请使用右键管理员身份运行&amp;&amp;<span class="hljs-built_in">Pause</span> &gt;<span class="hljs-built_in">NUL</span>&amp;&amp;<span class="hljs-keyword">Exit</span>)<br><span class="hljs-built_in">Rd</span> "<span class="hljs-variable">%WinDir%</span>\System32\test_permissions" <span class="hljs-number">2</span>&gt;<span class="hljs-built_in">NUL</span><br><span class="hljs-built_in">SetLocal</span> EnableDelayedExpansion<br><br><span class="hljs-keyword">call</span> %~dp0create_depends_env.bat<br><br>::设置右键菜单项的名称<br><span class="hljs-built_in">set</span> desc="Msys2-Vim"<br>::设置搭建编译环境的BAT<br><span class="hljs-built_in">set</span> runbat="run_msys2_vim.bat"<br>::设置子路径名称<br><span class="hljs-built_in">set</span> subname="msys2_vim"<br>::去掉双引号，主要是为了兼容包含了空格的文件名或路径<br><span class="hljs-keyword">call</span> :removequotes runbat<br><span class="hljs-keyword">call</span> :removequotes subname<br><br>::添加注册表信息<br>reg add "HKEY_CLASSES_ROOT\Directory\background\shell\<span class="hljs-variable">%subname%</span>" /v "" /t REG_SZ /d <span class="hljs-variable">%desc%</span><br>reg add "HKEY_CLASSES_ROOT\Directory\background\shell\<span class="hljs-variable">%subname%</span>\command" /v ""  /t REG_EXPAND_SZ /d "\"<span class="hljs-variable">%~dp0%</span>runbat%\" \"<span class="hljs-variable">%%V</span>\"<br><br>reg add "HKEY_CURRENT_USER\Software\Classes\*\shell\<span class="hljs-variable">%subname%</span>" /v "" /t REG_SZ /d <span class="hljs-variable">%desc%</span><br>reg add "HKEY_CURRENT_USER\Software\Classes\*\shell\<span class="hljs-variable">%subname%</span>\command" /v "" /t REG_EXPAND_SZ /d "\"<span class="hljs-variable">%~dp0%</span>runbat%\" \"<span class="hljs-variable">%%V</span>\"<br><br>reg add "HKEY_CLASSES_ROOT\Directory\shell\<span class="hljs-variable">%subname%</span>" /v "" /t REG_SZ /d <span class="hljs-variable">%desc%</span><br>reg add "HKEY_CLASSES_ROOT\Directory\shell\<span class="hljs-variable">%subname%</span>\command" /v "" /t REG_EXPAND_SZ /d "\"<span class="hljs-variable">%~dp0%</span>runbat%\" \"<span class="hljs-variable">%%V</span>\"<br><br>:removequotes<br><span class="hljs-keyword">FOR</span> /F "delims=" <span class="hljs-variable">%%A</span> <span class="hljs-keyword">IN</span> ('<span class="hljs-built_in">echo</span> <span class="hljs-variable">%%%</span><span class="hljs-number">1</span><span class="hljs-variable">%%'</span>) <span class="hljs-keyword">DO</span> <span class="hljs-built_in">set</span> <span class="hljs-variable">%1=%</span>%~A<br><span class="hljs-keyword">GOTO</span> :eof<br></code></pre></td></tr></table></figure><br><br></details>

<details><br>  <summary>run_msys2_vim.bat</summary><br><br><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br><br><span class="hljs-keyword">call</span> %~dp0config.bat<br><br><span class="hljs-built_in">set</span> ROOT=%<span class="hljs-number">1</span><br><span class="hljs-keyword">call</span> :removequotes ROOT<br><br><span class="hljs-built_in">pushd</span> "<span class="hljs-variable">%ROOT%</span>" <span class="hljs-number">2</span>&gt;<span class="hljs-built_in">nul</span> &amp;&amp; (<span class="hljs-keyword">call</span> :folder "<span class="hljs-variable">%ROOT%</span>" &amp; <span class="hljs-built_in">popd</span>) || <span class="hljs-keyword">call</span> :file "<span class="hljs-variable">%ROOT%</span>"<br><span class="hljs-keyword">GOTO</span> :eof<br><br>:file<br><span class="hljs-keyword">call</span> :filename ROOT file_name<br><span class="hljs-keyword">call</span> :dirname ROOT dir_name<br><br><span class="hljs-built_in">set</span> command_args=<span class="hljs-variable">%msys2_type%</span> -where "<span class="hljs-variable">%dir_name%</span>"<br><span class="hljs-keyword">call</span> <span class="hljs-variable">%msys2_shell_bat%</span> <span class="hljs-variable">%command_args%</span> -outside_exec "vim '<span class="hljs-variable">%file_name%</span>'"<br><span class="hljs-keyword">GOTO</span> :eof<br><br>:folder<br><span class="hljs-built_in">set</span> command_args=<span class="hljs-variable">%msys2_type%</span> -where "<span class="hljs-variable">%ROOT%</span>"<br><span class="hljs-keyword">call</span> <span class="hljs-variable">%msys2_shell_bat%</span> <span class="hljs-variable">%command_args%</span><br><span class="hljs-keyword">GOTO</span> :eof<br><br>:removequotes<br><span class="hljs-keyword">FOR</span> /F "delims=" <span class="hljs-variable">%%A</span> <span class="hljs-keyword">IN</span> ('<span class="hljs-built_in">echo</span> <span class="hljs-variable">%%%</span><span class="hljs-number">1</span><span class="hljs-variable">%%'</span>) <span class="hljs-keyword">DO</span> <span class="hljs-built_in">set</span> <span class="hljs-variable">%1=%</span>%~A<br><span class="hljs-keyword">GOTO</span> :eof<br><br>:dirname<br><span class="hljs-keyword">FOR</span> /F "delims=" <span class="hljs-variable">%%A</span> <span class="hljs-keyword">IN</span> ('<span class="hljs-built_in">echo</span> <span class="hljs-variable">%%%</span><span class="hljs-number">1</span><span class="hljs-variable">%%'</span>) <span class="hljs-keyword">DO</span> <span class="hljs-built_in">set</span> <span class="hljs-variable">%2=%</span>%~dpA<br><span class="hljs-keyword">GOTO</span> :eof<br><br>:filename<br><span class="hljs-keyword">FOR</span> /F "delims=" <span class="hljs-variable">%%A</span> <span class="hljs-keyword">IN</span> ('<span class="hljs-built_in">echo</span> <span class="hljs-variable">%%%</span><span class="hljs-number">1</span><span class="hljs-variable">%%'</span>) <span class="hljs-keyword">DO</span> <span class="hljs-built_in">set</span> <span class="hljs-variable">%2=%</span>%~nxA<br><span class="hljs-keyword">GOTO</span> :eof<br></code></pre></td></tr></table></figure><br><br></details>

<p>提供一个脚本来关联msys2和当前脚本的关系</p>
<details><br>  <summary>create_depends_env.bat</summary><br><br><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-comment">REM 创建目录关联</span><br><br><span class="hljs-built_in">echo</span> 将msys2目录粘贴到这里<br><span class="hljs-built_in">set</span> /p msys2_dir=<br><br><span class="hljs-keyword">call</span> :removequotes msys2_dir<br><span class="hljs-comment"><br>@REM 自动生成config.bat</span><br><span class="hljs-built_in">set</span> config_path="%~dp0config.bat"<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">exist</span> <span class="hljs-variable">%config_path%</span> (<br>    <span class="hljs-built_in">echo</span> @<span class="hljs-built_in">echo</span> off&gt;&gt; <span class="hljs-variable">%config_path%</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-built_in">set</span> msys2_install_dir="<span class="hljs-variable">%msys2_dir%</span>"&gt;&gt; <span class="hljs-variable">%config_path%</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-built_in">set</span> msys2_shell_bat="<span class="hljs-variable">%msys2_dir%</span>\msys2_shell.<span class="hljs-built_in">cmd</span>"&gt;&gt; <span class="hljs-variable">%config_path%</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-built_in">set</span> msys2_type=-mingw64&gt;&gt; <span class="hljs-variable">%config_path%</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-built_in">set</span> pause_cmd=read -p 'Please press any key after'&gt;&gt; <span class="hljs-variable">%config_path%</span><br>)<br><br><span class="hljs-keyword">GOTO</span> :eof<br><br>:removequotes<br><span class="hljs-keyword">FOR</span> /F "delims=" <span class="hljs-variable">%%A</span> <span class="hljs-keyword">IN</span> ('<span class="hljs-built_in">echo</span> <span class="hljs-variable">%%%</span><span class="hljs-number">1</span><span class="hljs-variable">%%'</span>) <span class="hljs-keyword">DO</span> <span class="hljs-built_in">set</span> <span class="hljs-variable">%1=%</span>%~A<br><span class="hljs-keyword">GOTO</span> :eof<br><br><span class="hljs-keyword">GOTO</span> :eof<br></code></pre></td></tr></table></figure><br><br></details>

<p>最终成品：<a href="https://github.com/YaoXuanZhi/msys2_vim" target="_blank" rel="noopener">msys2_vim</a></p>
<h2 id="参考资料" class="article-heading"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料<a class="article-anchor" href="#参考资料" aria-hidden="true"></a></h2><ul>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/help/msys2/" target="_blank" rel="noopener">MSYS2 镜像使用帮助</a></li>
<li><a href="https://unix.stackexchange.com/questions/285009/forward-aliases-to-child-process" target="_blank" rel="noopener">forward aliases to child process</a></li>
<li><a href="https://stackoverflow.com/questions/2752974/invoking-msys-bash-from-windows-cmd" target="_blank" rel="noopener">invoking-msys-bash-from-windows-cmd</a></li>
<li><a href="https://stackoverflow.com/questions/2546757/executing-msys-from-cmd-exe-with-arguments" target="_blank" rel="noopener">executing-msys-from-cmd-exe-with-arguments</a></li>
<li><a href="https://stackoverflow.com/questions/45836650/how-do-i-integrate-msys2-shell-into-visual-studio-code-on-window/48016561#48016561" target="_blank" rel="noopener">how-do-i-integrate-msys2-shell-into-visual-studio-code-on-window</a></li>
</ul>

  </div>
  
</article>

        
      
    </div>
  </div>
</div>
    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      &copy; 2022 <a href="https://github.com/hexojs/hexo/graphs/contributors" target="_blank">Hexo</a><br>
      Documentation licensed under <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.
    </div>
    <div id="footer-links">
      <a href="https://twitter.com/" class="footer-link" target="_blank"><i class="fa fa-twitter"></i></a>
      <a href="https://github.com/" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a>
    </div>
  </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/news/" class="mobile-nav-link">随笔</a><a href="/dev/" class="mobile-nav-link">开发</a><a href="/open_source/" class="mobile-nav-link">开源</a><a href="/tool/" class="mobile-nav-link">工具</a><a href="/about/" class="mobile-nav-link">关于我</a>
      <li class="mobile-nav-item">
        <a href="https://github.com/" class="mobile-nav-link" rel="external" target="_blank">GitHub</a>
      </li>
    </ul>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>简体中文</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="zh-cn" selected>简体中文</option>
      
    </select>
  </div>
</nav>
  <!-- Scripts -->
<!-- build:js build/js/main.js -->
<script src="/js/lang_select.js"></script>
<script src="/js/toc.js"></script>
<script src="/js/mobile_nav.js"></script>
<!-- endbuild -->

<!-- Algolia --><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->


</body>
</html>